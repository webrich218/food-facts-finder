<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>NutriFind – Recipe Nutrition Calculator</title>
<style>
 body { font-family: Arial, sans-serif; background:#f5f7f8; margin:0; padding:0; color:#222; min-height:100vh; display:flex; flex-direction:column; }
 header { text-align:center; padding:25px 15px 10px; }
 header img { width:50px; }
 .container { flex:1; max-width:750px; margin:auto; padding:10px 20px 40px; }
 .ingredient-row { display:flex; flex-wrap:wrap; gap:10px; margin-bottom:8px; }
 input, select { padding:10px; border:1px solid #ccc; border-radius:6px; flex:1; min-width:120px; }
 .add-btn, .calc-btn, .copy-btn, .share-btn { background:#0a7c36; color:#fff; border:none; padding:10px 14px; border-radius:6px; cursor:pointer; margin-top:10px; }
 .copy-btn { background:#222; }
 table { width:100%; border-collapse:collapse; margin-top:25px; }
 table td { padding:6px 0; border-bottom:1px solid #ccc; }
 table td:last-child { text-align:right; }
 table tr:first-child td {
  font-weight:bold;
  font-size:20px;
  border-bottom:4px solid #000;
 }
 footer { position:sticky; bottom:0; background:#fff; padding:15px; text-align:center; font-size:13px; color:#777; border-top:1px solid #ddd; }
 canvas { margin-top:20px; max-width:100%; height:260px; display:block; }
</style>
</head>
<body>
<header>
 <img src="/favicon.png" alt="logo">
 <h1>NutriFind Recipe Calculator</h1>
</header>
<div class="container">
 <div id="ingredientsContainer"></div>
 <button class="add-btn" onclick="addIngredient()">+ Add Ingredient</button>
 <button class="calc-btn" onclick="calculateRecipe()">Calculate Nutrition</button>

 <div id="resultsCard" style="display:none;">
   <table id="nutritionTable"></table>
   <canvas id="macroChart"></canvas>
   <div class="share-buttons" style="display:flex; gap:10px; margin-top:10px;">
      <button class="copy-btn" onclick="copyTable()">Copy</button>
      <button class="share-btn" onclick="shareTable()">Share</button>
   </div>
 </div>
</div>
<footer>
  NutriFind © 2025 · Powered by CalorieNinjas API
</footer>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
function ingredientRowHTML(){
 return `
  <div class="ingredient-row">
    <input type="text" class="food" placeholder="Ingredient" />
    <input type="number" class="amount" placeholder="Amount" value="100" />
    <select class="unit">
      <option value="g">g</option>
      <option value="cup">cup</option>
      <option value="tbsp">tbsp</option>
      <option value="tsp">tsp</option>
      <option value="piece">piece</option>
    </select>
    <button onclick="this.parentElement.remove()">✕</button>
  </div>`;
}
function addIngredient(){ document.getElementById('ingredientsContainer').insertAdjacentHTML('beforeend', ingredientRowHTML()); }
addIngredient();
async function getNutrition(query){
 const res = await fetch(`/api/nutrition?query=${encodeURIComponent(query)}`);
 return await res.json();
}
let macroChartInstance=null;
async function calculateRecipe(){
 const rows = document.querySelectorAll('.ingredient-row');
 let totals = {cal:0, fat:0, carb:0, protein:0};
 for(const row of rows){
  const food = row.querySelector('.food').value.trim();
  const amt = row.querySelector('.amount').value;
  const unit = row.querySelector('.unit').value;
  if(!food) continue;
  const query = `${amt}${unit} ${food}`;
  const data = await getNutrition(query);
  if(!data.items || !data.items.length) continue;
  const item = data.items[0];
  totals.cal += item.calories || 0;
  totals.fat += item.fat_total_g || 0;
  totals.carb += item.carbohydrates_total_g || 0;
  totals.protein += item.protein_g || 0;
 }
 document.getElementById('resultsCard').style.display='block';
 document.getElementById('nutritionTable').innerHTML=`
  <tr><td><strong>Total Calories</strong></td><td><strong>${Math.round(totals.cal)}</strong></td></tr>
  <tr><td>Fat</td><td>${totals.fat.toFixed(1)} g</td></tr>
  <tr><td>Carbs</td><td>${totals.carb.toFixed(1)} g</td></tr>
  <tr><td>Protein</td><td>${totals.protein.toFixed(1)} g</td></tr>`;

 const ctx=document.getElementById("macroChart").getContext("2d");
 if(macroChartInstance) macroChartInstance.destroy();
 macroChartInstance=new Chart(ctx,{
  type:"pie",
  data:{ labels:["Fat","Carbs","Protein"], datasets:[{ data:[totals.fat, totals.carb, totals.protein], backgroundColor:["#ff6384","#36a2eb","#ffcd56"] }]},
  options:{ plugins:{ legend:{position:"bottom"}} }
 });
}
function copyTable(){ navigator.clipboard.writeText(document.getElementById("nutritionTable").innerText); alert("Copied to clipboard!"); }
async function shareTable(){ const text=document.getElementById("nutritionTable").innerText; if(navigator.share){ await navigator.share({text}); } else{ alert("Sharing not supported on this browser."); }}
</script>
</body>
</html>
