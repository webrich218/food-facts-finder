<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>NutriFind ‚Äî Recipe Nutrition Calculator</title>

<style>
:root{
  --bg:#ffffff;
  --text:#111;
  --card:#f9f9f9;
  --border:#ddd;
  --accent:#2e7d32;
}
body.dark{
  --bg:#1b1b1b;
  --text:#eee;
  --card:#2b2b2b;
  --border:#444;
  --accent:#7ee693;
}
body{
  background:var(--bg);
  color:var(--text);
  font-family:Arial, sans-serif;
  margin:0;
  padding:20px;
  transition:0.3s;
}

header{text-align:center;}
header img{width:48px;}

.container{max-width:760px;margin:auto;padding:10px 0;}
.ingredient-row{display:flex;gap:10px;margin-bottom:8px;}
input,select{
  padding:10px;border:1px solid var(--border);
  border-radius:6px;flex:1;background:var(--card);color:var(--text);
}
.add-btn,.calc-btn{
  background:var(--accent);
  color:white;border:none;padding:10px 14px;
  border-radius:6px;cursor:pointer;margin-top:10px;
}

.nutrition-card{
  background:var(--card);
  border:1px solid var(--border);
  padding:20px;border-radius:12px;margin-top:25px;
  text-align:center;
}

table{width:100%;border-collapse:collapse;margin-top:15px;}
td{padding:10px 0;border-bottom:1px solid var(--border);}
td:last-child{text-align:right;font-weight:bold;}

.share-buttons{margin-top:18px;display:flex;gap:10px;justify-content:center;}
.copy-btn{
  background:#222;border:none;color:#fff;cursor:pointer;
  padding:8px 12px;border-radius:6px;
}

/* Floating dark mode toggle */
#themeToggle{
  position:fixed;
  bottom:20px;
  right:20px;
  background:var(--accent);
  color:white;
  border:none;
  font-size:18px;
  border-radius:50%;
  width:45px;
  height:45px;
  cursor:pointer;
}
</style>

</head>
<body>

<header>
  <h1>NutriFind Recipe Calculator</h1>
</header>

<div class="container">
  <p>Enter ingredients and amounts to calculate total calories & macros.</p>

  <div id="ingredientsContainer"></div>

  <button class="add-btn" onclick="addIngredient()">+ Add Ingredient</button>
  <button class="calc-btn" onclick="calculateRecipe()">Calculate Nutrition</button>

  <div id="resultsCard" style="display:none;" class="nutrition-card">
    <h2>Nutrition Facts</h2>
    <table id="nutritionTable"></table>
    <div class="share-buttons">
      <button class="copy-btn" onclick="copyTable()">Copy</button>
      <button class="copy-btn" onclick="shareTable()">Share</button>
    </div>
  </div>
</div>

<button id="themeToggle">üåô</button>

<script>
/* Dark mode toggle w/ emoji */
const toggleBtn=document.getElementById("themeToggle");
if(localStorage.getItem("theme")==="dark"){
  document.body.classList.add("dark");
  toggleBtn.textContent="‚òÄÔ∏è";
}
toggleBtn.onclick=()=>{
  document.body.classList.toggle("dark");
  const dark=document.body.classList.contains("dark");
  toggleBtn.textContent=dark?"‚òÄÔ∏è":"üåô";
  localStorage.setItem("theme", dark?"dark":"light");
};

/* Ingredient rows */
function ingredientRowHTML(){
 return `
  <div class="ingredient-row">
    <input type="text" class="food" placeholder="Ingredient">
    <input type="number" class="amount" placeholder="Amount" value="100">
    <select class="unit">
      <option value="g">g</option>
      <option value="cup">cup</option>
      <option value="tbsp">tbsp</option>
      <option value="tsp">tsp</option>
      <option value="piece">piece</option>
    </select>
    <button onclick="this.parentElement.remove()">‚úï</button>
  </div>`;
}
function addIngredient(){
 document.getElementById("ingredientsContainer")
   .insertAdjacentHTML("beforeend", ingredientRowHTML());
}
addIngredient(); // default row

/* API fetch via Vercel */
async function getNutrition(q){
  const res=await fetch(`/api/nutrition?query=${encodeURIComponent(q)}`);
  return await res.json();
}

/* Total calculation */
async function calculateRecipe(){
  const rows=document.querySelectorAll(".ingredient-row");
  let totals={cal:0,fat:0,carb:0,protein:0};
  for(const row of rows){
    const food=row.querySelector(".food").value.trim();
    const amt=row.querySelector(".amount").value;
    const unit=row.querySelector(".unit").value;
    if(!food) continue;
    const query=`${amt}${unit} ${food}`;
    const data=await getNutrition(query);
    if(!data.items || !data.items.length) continue;
    const item=data.items[0];
    totals.cal += item.calories||0;
    totals.fat += item.fat_total_g||0;
    totals.carb += item.carbohydrates_total_g||0;
    totals.protein += item.protein_g||0;
  }
  document.getElementById("resultsCard").style.display="block";
  document.getElementById("nutritionTable").innerHTML=`
    <tr><td>Calories</td><td>${Math.round(totals.cal)}</td></tr>
    <tr><td>Fat</td><td>${totals.fat.toFixed(1)} g</td></tr>
    <tr><td>Carbs</td><td>${totals.carb.toFixed(1)} g</td></tr>
    <tr><td>Protein</td><td>${totals.protein.toFixed(1)} g</td></tr>`;
}

/* Copy + share */
function copyTable(){
  const txt=document.getElementById("nutritionTable").innerText;
  navigator.clipboard.writeText(txt);
  alert("Copied!");
}
async function shareTable(){
  const txt=document.getElementById("nutritionTable").innerText;
  if(navigator.share){await navigator.share({text:txt});}
  else alert("Sharing not supported here.");
}
</script>

</body>
</html>
