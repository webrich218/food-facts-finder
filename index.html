<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>NutriFind | Nutrition Facts & Calories</title>
  <meta name="description" content="NutriFind helps you instantly search nutrition facts, calories, macros, and serving sizes. Copy or share results easily.">
  <meta name="theme-color" content="#009578">
  <link rel="icon" type="image/png" href="https://twemoji.maxcdn.com/v/latest/72x72/1f957.png" />
  <style>
    :root {
      --bg: #f9fafb;
      --text: #111;
      --accent: #009578;
      --border: #ddd;
      --card-bg: #fff;
    }
    body.dark {
      --bg: #111827;
      --text: #f3f4f6;
      --accent: #22c55e;
      --border: #374151;
      --card-bg: #1f2937;
    }
    body {
      font-family: 'Inter', sans-serif;
      background: var(--bg);
      color: var(--text);
      margin: 0;
      padding: 40px 20px 100px;
      display: flex;
      flex-direction: column;
      align-items: center;
      min-height: 100vh;
    }
    h1 { text-align:center; margin-bottom:6px; }
    p { text-align:center; color:#666; }
    body.dark p { color:#ccc; }
    #themeToggle {
      position:fixed; bottom:20px; left:50%; transform:translateX(-50%);
      background:var(--card-bg); border:1px solid var(--border);
      padding:10px 18px; border-radius:25px; cursor:pointer;
    }
    .container { width:100%; max-width:450px; padding:0 12px; }
    input, select {
      width:100%; padding:14px 16px; border-radius:10px;
      border:1px solid var(--border); margin-bottom:14px;
    }
    body.dark input, body.dark select { background:#374151; border-color:#4b5563; color:#fff; }
    .nutrition-facts {
      background:var(--card-bg); padding:20px; border-radius:16px;
      box-shadow:0 2px 15px rgba(0,0,0,0.08); margin-top:20px; display:none;
    }
    .nutrition-facts h2 {
      text-align:center; font-weight:800; border-bottom:4px solid var(--accent);
      padding-bottom:6px;
    }
    .calories { display:flex; justify-content:space-between; font-size:1.6rem; font-weight:700; }
    .nutrient { display:flex; justify-content:space-between; border-bottom:1px solid var(--border); padding:6px 0; }
    footer { margin-top:40px; text-align:center; font-size:0.85rem; opacity:0.9; }
    .content-section {
      max-width:750px;
      margin-top:50px;
      line-height:1.6;
    }
    .content-section h2 {
      margin-top:35px;
      color:var(--accent);
    }
  </style>
</head>
<body>

<h1>ðŸ¥— NutriFind</h1>
<p>Instantly search calories, macros, and nutrition facts.</p>

<div class="container">
  <input type="text" id="search" placeholder="e.g. apple, chicken breast, rice" />
  <input type="number" id="qty" min="1" value="1" />
  <select id="unit">
    <option value="gram">Grams (g)</option>
    <option value="ml">Milliliters (ml)</option>
    <option value="cup">Cup</option>
    <option value="tbsp">Tablespoon</option>
    <option value="tsp">Teaspoon</option>
    <option value="piece">Piece</option>
    <option value="oz">Ounce (oz)</option>
  </select>

  <div id="loading" style="display:none; text-align:center;">Loading...</div>
  <div id="result" class="nutrition-facts"></div>
</div>

<footer>
  Â© 2025 NutriFind<br>
  Nutrition data from CalorieNinjas API<br>
  <a href="#legal" style="color:var(--accent); font-weight:600;">Legal & Privacy</a>
</footer>

<button id="themeToggle">ðŸŒ™ Dark Mode</button>

<div class="content-section">
  <h2>What is NutriFind?</h2>
  <p>NutriFind is a fast nutrition checker that lets you search any food and instantly see calories, macros, and nutrition facts. It supports serving sizes like grams, cups, tablespoons, teaspoons, ounces, and pieces.</p>

  <h2>How to Use the Nutrition Calculator</h2>
  <p>Type any food into the search bar â€” for example: <strong>egg</strong>, <strong>apple</strong>, <strong>fried rice</strong>, or <strong>chicken breast</strong>. Then choose your desired amount and unit. NutriFind automatically converts the serving size into grams for accurate results.</p>

  <h2 id="legal">Privacy & Terms</h2>
  <p>NutriFind does not store your personal data. Searches are anonymous and processed only to retrieve nutrition results. By using this site, you agree that the information is for general purposes only and may vary based on preparation, brand, or cooking method.</p>
</div>

<script>
const toggle = document.getElementById("themeToggle");
if (localStorage.getItem("theme") === "dark") {
  document.body.classList.add("dark");
  toggle.textContent = "â˜€ï¸ Light";
}
toggle.onclick = () => {
  document.body.classList.toggle("dark");
  const d = document.body.classList.contains("dark");
  toggle.textContent = d ? "â˜€ï¸ Light" : "ðŸŒ™ Dark";
  localStorage.setItem("theme", d ? "dark" : "light");
};

const lookup = {
  "apple": { piece: 182 },
  "banana": { piece: 118 },
  "egg": { piece: 50 },
  "rice cooked": { cup: 158 }
};

const search = document.getElementById("search");
const qty = document.getElementById("qty");
const unit = document.getElementById("unit");
const result = document.getElementById("result");
const loading = document.getElementById("loading");
let timer;

function convert(name, q, u) {
  const food = lookup[name.toLowerCase()];
  const cup = 240, tbsp = 15, tsp = 5, oz = 28.35;

  if (u === "gram" || u === "ml") return q;
  if (u === "oz") return q * oz;

  if (u === "cup") return food?.cup ? q * food.cup : q * cup;
  if (u === "tbsp") return q * tbsp;
  if (u === "tsp") return q * tsp;
  if (u === "piece") return food?.piece ? q * food.piece : q * 100;

  return q * 100;
}

search.addEventListener("input", () => {
  clearTimeout(timer);
  if (search.value.trim().length < 2) return;
  timer = setTimeout(() => fetchData(search.value.trim()), 600);
});

qty.oninput = () => refreshIfVisible();
unit.onchange = () => refreshIfVisible();

function refreshIfVisible() {
  if (result.style.display === "block" && window._lastFood) {
    show(window._lastFood);
  }
}

async function fetchData(q) {
  loading.style.display = "block";
  result.style.display = "none";

  const res = await fetch(`/api/nutrition?query=${encodeURIComponent(q)}`);
  const data = await res.json();

  if (!data.items?.length) {
    result.innerHTML = "<p>No results.</p>";
    result.style.display = "block";
    loading.style.display = "none";
    return;
  }

  const food = data.items[0];
  window._lastFood = food;
  show(food);
  loading.style.display = "none";
}

function show(food) {
  const grams = convert(food.name, parseFloat(qty.value), unit.value);
  const scale = grams / 100;
  const c = (x) => (x * scale).toFixed(1);

  result.style.display = "block";
  result.innerHTML = `
    <h2>Nutrition Facts</h2>
    <div class="calories"><span>Calories</span><span>${c(food.calories)}</span></div>
    <div class="nutrient"><span>Fat</span><span>${c(food.fat_total_g)} g</span></div>
    <div class="nutrient"><span>Sodium</span><span>${c(food.sodium_mg)} mg</span></div>
    <div class="nutrient"><span>Carbs</span><span>${c(food.carbohydrates_total_g)} g</span></div>
    <div class="nutrient"><span>Fiber</span><span>${c(food.fiber_g)} g</span></div>
    <div class="nutrient"><span>Sugar</span><span>${c(food.sugar_g)} g</span></div>
    <div class="nutrient"><span>Protein</span><span>${c(food.protein_g)} g</span></div>
    <p style="margin-top:10px; font-size:0.9rem; opacity:0.8;">Serving: ${qty.value} ${unit.value} â†’ ${grams} g</p>
  `;
}
</script>

</body>
</html>
